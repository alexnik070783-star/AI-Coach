name: AI Coach Daily

on:
  schedule:
    # Время указано в UTC.
    # Беларусь/Москва = UTC+3.
    # GitHub может задерживать запуск на 20-40 мин, поэтому ставим с запасом.

    # УТРО: Хотим 07:00 (+3) -> Ставим 03:30 UTC
    # (Придет в районе 06:40 - 07:20 по твоему времени)
    - cron: '30 3 * * *'

    # ОБЕД: Хотим 14:00 (+3) -> Ставим 10:30 UTC
    # (Придет в районе 13:40 - 14:20)
    - cron: '30 10 * * *'

    # ВЕЧЕР: Хотим 22:00 (+3) -> Ставим 18:30 UTC
    # (Придет в районе 21:40 - 22:20)
    - cron: '30 18 * * *'

  workflow_dispatch: # Кнопка для ручного запуска

jobs:
  run-bot:
    runs-on: ubuntu-latest
    
    env:
      INTERVALS_ID: ${{ secrets.INTERVALS_ID }}
      INTERVALS_KEY: ${{ secrets.INTERVALS_KEY }}
      GOOGLE_KEY: ${{ secrets.GOOGLE_KEY }}
      TG_TOKEN: ${{ secrets.TG_TOKEN }}
      TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}

    steps:
      - name: Check out code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install requests matplotlib

      - name: Run Coach
        run: python main.py
